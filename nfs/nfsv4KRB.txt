
###Setup smartconnect for isilon
-isilon.vlab.local
test ssip & sc

-fix reverse dns
test with nslookup on name/IP

-fix spn
isilon/admin@VLABKDC.LOCAL
Password123!


###setup client for nfsv4

yum install rpcbind nfs-utils nfs4-acl-tools -y

vim /etc/idmapd.conf
[General]
Domain = vlab.local


###CentOS 6
service rpcbind start; chkconfig rpcbind on
service rpcidmapd start; chkconfig rpcidmapd on
chkconfig netfs on

show mount -e isilon.vlab.local

mkdir /mnt/nfsv4




###On Isilon
isi nfs settings global view
isi nfs settings global modify --nfsv4-enabled=true

isi nfs settings zone view
isi nfs settings zone modify --nfsv4-domain=vlab.local


isi nfs exports delete --id=1
mkdir /ifs/mp
mkdir /ifs/mp/nfsv4
chmod -R 777 /ifs/mp/nfsv4
isi nfs exports create --path=/ifs/mm/nfsv4 --map-root=root
isi nfs exports list -view




###On Client
mount -t nfs4 isilon.vlab.local:/ifs/mp/nfsv4 /mnt/nfsv4
mountstats

cd /mnt/nfsv4
touch 1.txt
ls -al

nfs4_getfacl 1.txt
nfs4_setfacl



su - kdcuser1
touch 2.txt
ls -al
nfs4_getfacl

ls -al  on isilon
ls -le 	on isilon





###Kerberos
###on KDC
kadmin.local
listprincs
apprinc -randkey nfs/KDC.vlab.local
apprinc -randkey host/KDC.vlab.local

ktadd -k /root/nfs-krb5.keytab nfs/KDC.vlab.local
ktadd -k /root/host-krb5.keytab host/KDC.vlab.local


ktutil
ktutil:  list

ktutil:  rkt /root/nfs-krb5.keytab
ktutil:  rkt /root/host-krb5.keytab
ktutil:  list

ktutil:  wkt /etc/krb5.keytab
ktutil:  exit

ktutil
ktutil: rkt /etc/krb5.keytab
ktutil:  list




######On Host
vi /etc/sysconfig/nfs

SECURE_NFS="yes"


service nfs restart
service rpcidmapd restart
service rpcgssd restart
service rpcbind restart


modprobe rpcsec_gss_krb5


klist -k
klist -e

rpc.gssd -f -v

mount –t nfs4 –o sec=krb5 isilon.vlab.local:/ifs/data/mixed /mnt/nfsv4
mountstats

cd /mnt/nfsv4




su - kdcuser1
klist
kinit
klist
cd /mnt/nfsv4

