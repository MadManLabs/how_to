####SETUP ISILON view and validate process
(see bottom of file for just commands)


isi license list
isi license activate --key ISILO-HJXC0-H15JU-YTZTW-OKZLT
isi license activate --key ISILO-HVOC0-PHOJU-YPATW-W4FKT
isi license list


isi zone zones create --name=zone1-cdh --path=/ifs/zone1/cdh --create-path
isi zone zones list --verbose


mkdir -p /ifs/zone1/cdh/hadoop-root
ls -al /ifs/zone1/cdh


isi network subnets list --verbose
isi network subnets modify groupnet0.subnet0 --sc-service-addr=192.168.1.100


isi network pools list --verbose
isi network pools create --id=groupnet0:subnet0:hadoop-pool-cdh --ranges=192.168.1.60-192.168.1.68  --access-zone=zone1-cdh  --alloc-method=dynamic  --ifaces=1-4:ext-1 --sc-subnet=subnet0  --sc-dns-zone=isilonsczone-cdh.vlab.local    --description=hadoop


isi network pools list --verbose
isi network pools view --id=groupnet0:subnet0:hadoop-pool-cdh





###################################################################################################
####SETUP windows DNS for SmartConnect Zone

#connect to domain controller DC
#admin tools DNS
#select vlab.local
add A record   ssip-isilon  192.168.1.100

#new delegation
	isilonsczone-cdh
#Add
	ssip-isilon.vlab.local
#Resolve, comes back as 192.168.1.100
#complete



#TEST SCZone
ping isilonsczone-cdh.vlab.local

#should resolve to 192.168.1.60-68

###################################################################################################



####Isilon HDFS Settings:
isi hdfs settings view --zone=zone1-cdh
isi hdfs settings modify --zone=zone1-cdh --root-directory=/ifs/zone1/cdh/hadoop-root
isi zone zones modify --user-mapping-rules="hdfs=>root" --zone=zone1-cdh


touch /ifs/zone1/cdh/hadoop-root/THIS_IS_ISILON_zone1-cdh.txt

isi auth settings acls modify --group-owner-inheritance=parent




####HDFS Users & Group setup
mkdir -p /ifs/zone1/cdh/scripts

https://github.com/Isilon/isilon_hadoop_tools

#clone or download, as a zip, go find the download, unzip
#winscp the isilon_create_users.sh & isilon_create_directories.sh  to /ifs/zone1/cdh/scripts

wget https://raw.githubusercontent.com/Isilon/isilon_hadoop_tools/master/isilon_create_users.sh --no-check-certificate
wget https://raw.githubusercontent.com/Isilon/isilon_hadoop_tools/master/isilon_create_directories.sh --no-check-certificate


cd /ifs/zone1/cdh/scripts
chmod u+x *

bash isilon_create_users.sh --dist cdh --startuid 501 --startgid 501  --zone zone1-cdh

bash isilon_create_directories.sh --dist cdh --zone zone1-cdh  --fixperm

ls -al /ifs/zone1/cdh/hadoop-root
ls -al /ifs/zone1/cdh/hadoop-root/user




####on Isilon
cat zone1-cdh.passwd
cat zone1-cdh.group

#go to HDFS01
vi /etc/passwd
#G
#o
#cut and paste content from zone1-cdh.passwd
esc :wq

vi /etc/group
#G
#o
#cut and paste content from zone1-cdh.group
esc :wq



#go to HDFS02
vi /etc/passwd
#G
#o
#cut and paste content from zone1-cdh.passwd
esc :wq

vi /etc/group
#G
#o
#cut and paste content from zone1-cdh.group
esc :wq




#go to HDFS03
vi /etc/passwd
#G
#o
#cut and paste content from zone1-cdh.passwd
esc :wq

vi /etc/group
#G
#o
#cut and paste content from zone1-cdh.group
esc :wq








****************************************************************************
##Cloudera Install

##Change Hostname to lower case & update DNS

vi /etc/sysconfig/network

##Linux HOST setup:
SELinux
	vi /etc/selinux/config 
	SELINUX=disabled

	
#IPtables off
chkconfig iptables off
chkconfig ip6tables off
chkconfig ntpdate on
chkconfig

yum install ntp
chkconfig ntpd on
service ntpd start
ntpq -p



##From windows go download the installer or wget with internet access; cloudera-manager-installer.bin
http://archive.cloudera.com/cm5/installer/5.8.2.3/
##Copy to CM host using winscp


cd /tmp
wget http://archive.cloudera.com/cm5/installer/5.8.2.3/cloudera-manager-installer.bin
chmod u+x  cloudera-manager-installer.bin
ls -al


##install cloudera manager
./cloudera-manager-installer.bin --skip_repo_package=1



##cloudera manager service check
service cloudera-scm-server status  
service cloudera-scm-server-db status

service cloudera-scm-server  restart
service cloudera-scm-server-db restart

Or a reboot


##now see the lab guide for local repo setup and configuration
See lab install doc for specifics with cloudera repos --- >  you have to change the repo locations in CM


##Goto to Cloudera Manager
http://192.168.1.40:7180

admin/admin

##Host to deploy
HDFS01.vlab.local
HDFS02.vlab.local
HDFS03.vlab.local


##Make repo changes for Cloudera CDH install
Page 17 of Support Isilon Hadoop Learning Guide, remove all the repos and add

http://192.168.1.20/cdh5.8.2/


##Host paswords
Password123!



##Deploy!  --- > no hdfs, no sqoop BUT add isilon

#Host Inspection
echo never > /sys/kernel/nm/transparent_huepage/defrag
usermod -a -G sqoop sqoop2

cat /proc/sys/vm/swappiness
	sysctl vm.swappiness=10
cat /proc/sys/vm/swappiness
	vi /etc/sysctl.config   (Add vm.swappiness=10)


#No hdfs service, add Isilon
	
	
	
default_fs_name      	hdfs://isilonsczone-cdh.vlab.local:8020
webhdfs_url      		hdfs://isilonsczone-cdh.vlab.local:8082/webhdfs/v1


Test:
hdfs dfs -ls /
hadoop jar hadoop-mapreduce-examples.jar pi 10 10








Just the isilon commands in one block:
#################################################################################
#################################################################################


isi license activate --key ISILO-HJXC0-H15JU-YTZTW-OKZLT
isi license activate --key ISILO-HVOC0-PHOJU-YPATW-W4FKT



isi zone zones create --name=zone1-cdh --path=/ifs/zone1/cdh --create-path
mkdir -p /ifs/zone1/cdh/hadoop-root
isi network subnets modify groupnet0.subnet0 --sc-service-addr=192.168.1.100
isi network pools create --id=groupnet0:subnet0:hadoop-pool-cdh --ranges=192.168.1.60-192.168.1.68  --access-zone=zone1-cdh  --alloc-method=dynamic  --ifaces=1-4:ext-1 --sc-subnet=subnet0  --sc-dns-zone=isilonsczone-cdh.vlab.local    --description=cdh_hadoop_access_zone
isi hdfs settings modify --zone=zone1-cdh --root-directory=/ifs/zone1/cdh/hadoop-root
isi zone zones modify --user-mapping-rules="hdfs=>root" --zone=zone1-cdh
touch /ifs/zone1/cdh/hadoop-root/THIS_IS_ISILON_zone1-cdh.txt
isi auth settings acls modify --group-owner-inheritance=parent
mkdir -p /ifs/zone1/cdh/scripts
cd /ifs/zone1/cdh/scripts
wget https://raw.githubusercontent.com/Isilon/isilon_hadoop_tools/master/isilon_create_users.sh --no-check-certificate
wget https://raw.githubusercontent.com/Isilon/isilon_hadoop_tools/master/isilon_create_directories.sh --no-check-certificate
chmod u+x *
bash isilon_create_users.sh --dist cdh --startuid 501 --startgid 501  --zone zone1-cdh
bash isilon_create_directories.sh --dist cdh --zone zone1-cdh  --fixperm




isi license list
isi zone zones list --verbose
isi network subnets list --verbose
isi network pools list --verbose
isi network pools view --id=groupnet0:subnet0:hadoop-pool-cdh
isi hdfs settings view --zone=zone1-cdh
ls -al /ifs/zone1/cdh/hadoop-root
ls -al /ifs/zone1/cdh/hadoop-root/user


#################################################################################
#################################################################################